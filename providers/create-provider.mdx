---
title: 'Crear Proveedor'
description: 'Guía paso a paso para agregar un nuevo proveedor a tu clínica'
icon: 'user-plus'
---

## Resumen

Crear un proveedor implica marcar a un usuario existente como proveedor o crear un nuevo usuario con el indicador de proveedor habilitado. Esta guía cubre ambos escenarios.

<Info>
  **Proveedores por Clínica**: Cuando creas un proveedor, se marca como proveedor SOLO en la clínica actual. El mismo usuario puede ser un miembro regular del personal en otras clínicas.
</Info>

## Requisitos Previos

Antes de crear un proveedor:

<Steps>
  <Step title="Permisos Requeridos">
    Debes tener el rol `CLINIC_ADMIN` en la clínica donde estás creando el proveedor.
  </Step>
  <Step title="Contexto de Clínica">
    Asegúrate de que la clínica correcta esté seleccionada en el selector de clínicas (menú desplegable superior derecho).
  </Step>
  <Step title="Información del Usuario">
    Prepara el correo electrónico, número de teléfono y nombre completo del proveedor.
  </Step>
</Steps>

## Método 1: Marcar Usuario Existente como Proveedor

Usa este método cuando el usuario ya existe en tu clínica (por ejemplo, personal administrativo que se convierte en proveedor).

<Steps>
  <Step title="Navegar a Usuarios">
    Ve a la sección **Usuarios** desde el menú principal.
  </Step>
  <Step title="Encontrar el Usuario">
    Usa la búsqueda para localizar al usuario por nombre o correo electrónico.
  </Step>
  <Step title="Abrir Diálogo de Edición">
    Haz clic en el ícono **Editar** en la tarjeta del usuario.
  </Step>
  <Step title="Habilitar Indicador de Proveedor">
    Cambia **Es Proveedor** a `true`.
  </Step>
  <Step title="Guardar Cambios">
    Haz clic en **Guardar** para actualizar el perfil del usuario.
  </Step>
</Steps>


<Warning>
  **Citas Existentes**: Si el usuario tenía citas programadas ANTES de ser marcado como proveedor, esas citas permanecen válidas. Las citas futuras ahora se calcularán usando la disponibilidad de proveedor de este usuario.
</Warning>

## Método 2: Crear Nuevo Usuario como Proveedor

Usa este método cuando contratas a un nuevo miembro del equipo que será proveedor.

<Frame>
  <img src="/images/screenshots/providers_create_form.png" alt="Formulario de creación de proveedor con campos de información y flag de proveedor" />
</Frame>

<Steps>
  <Step title="Navegar a Crear Usuario">
    Ve a **Usuarios** → **Crear Usuario** o haz clic en el botón **Agregar Usuario**.
  </Step>
  <Step title="Completar Información del Usuario">
    - **Nombre Completo**: Nombre completo del proveedor
    - **Correo Electrónico**: Dirección de correo profesional (debe ser única globalmente)
    - **Teléfono**: Formato E.164 (ej: `+34612345678`)
    - **Rol**: Selecciona el rol de clínica (`STAFF` o `CLINIC_ADMIN`)
  </Step>
  <Step title="Habilitar Indicador de Proveedor">
    Cambia **Es Proveedor** a `true`.
  </Step>
  <Step title="Establecer Estado Inicial">
    Elige `approved` (activo inmediatamente) o `pending` (requiere aprobación).
  </Step>
  <Step title="Enviar Formulario">
    Haz clic en **Crear Usuario** para guardar.
  </Step>
</Steps>

### Solicitud API (Método 2)


## Detalles de Campos

### Correo Electrónico

<AccordionGroup>
  <Accordion title="Restricción de Unicidad">
    El correo electrónico debe ser único **globalmente** (en todas las clínicas). Dos usuarios no pueden compartir la misma dirección de correo electrónico.

    **Ejemplo de Error**:
    ```json
    {
      "detail": "Email already in use"
    }
    ```

    **Solución**: Usa un correo electrónico diferente o identifica al usuario existente y márcalo como proveedor en su lugar (Método 1).
  </Accordion>

  <Accordion title="Validación de Formato">
    El correo electrónico debe tener un formato de dirección de correo válido.

    **Válido**: `maria.garcia@namsec.es`, `juan+provider@example.org`

    **Inválido**: `maria.garcia`, `juan@`, `@namsec.es`
  </Accordion>
</AccordionGroup>

### Número de Teléfono

<AccordionGroup>
  <Accordion title="Formato E.164 Requerido">
    Los números de teléfono DEBEN estar en formato E.164: `+[código de país][número]`

    **Ejemplos**:
    - España: `+34612345678`
    - EE.UU.: `+14155551234`
    - México: `+525512345678`

    **Inválido**: `612345678`, `(415) 555-1234`, `+34 612 345 678`
  </Accordion>

  <Accordion title="Unicidad Global">
    Los números de teléfono deben ser únicos **globalmente** (en todas las clínicas), similar al correo electrónico.

    **Ejemplo de Error**:
    ```json
    {
      "detail": "Phone number already in use"
    }
    ```
  </Accordion>

  <Accordion title="Normalización">
    El sistema usa `normalize_phone_to_e164()` para convertir varios formatos:

    ```python
    # Entrada: "612345678" (España, asumiendo prefijo +34)
    # Salida: "+34612345678"

    # Entrada: "+34 612 345 678"
    # Salida: "+34612345678"
    ```

    **Mejor Práctica**: Siempre proporciona números de teléfono en formato E.164 para evitar problemas de análisis.
  </Accordion>
</AccordionGroup>

### Nombre Completo

<AccordionGroup>
  <Accordion title="Almacenamiento por Clínica">
    El nombre completo se almacena en `user_clinic_profiles.full_name`, lo que significa:
    - El mismo usuario puede tener nombres diferentes en diferentes clínicas
    - El nombre está vinculado a la relación `user_clinic`, no a la tabla global `users`

    **Ejemplo**:
    - Clínica A: "Dr. María García Rodríguez"
    - Clínica B: "María García" (mismo usuario, nombre informal)
  </Accordion>

  <Accordion title="Actualizaciones de Nombres Multi-Clínica">
    Cuando un paciente existe en la Clínica A como "Manuel López" y reserva en la Clínica B como "Eduardo Cassanovas", el sistema:
    1. Asocia al usuario con la Clínica B (crea nuevo `user_clinic`)
    2. Actualiza el nombre global a "Eduardo Cassanovas" (respeta la entrada más reciente)

    Ver `docs/FIX_MULTI_CLINIC_PATIENT_NAME_UPDATE.md` para detalles completos.
  </Accordion>
</AccordionGroup>

### Rol de Clínica

<CardGroup cols={3}>
  <Card title="STAFF" icon="user">
    Miembro estándar del equipo con acceso a los datos de su clínica.
  </Card>
  <Card title="CLINIC_ADMIN" icon="user-shield">
    Puede gestionar la configuración de la clínica, usuarios, proveedores y servicios.
  </Card>
  <Card title="ADMIN" icon="crown">
    Administrador del sistema con acceso a TODAS las clínicas (rol global).
  </Card>
</CardGroup>

<Tip>
  **Independencia de Roles**: Un usuario puede ser `CLINIC_ADMIN` en la Clínica A y `STAFF` en la Clínica B. Los roles son por clínica, almacenados en `user_clinics.clinic_role_id`.
</Tip>

### Estado

<CardGroup cols={3}>
  <Card title="approved" icon="circle-check">
    **Proveedor Activo**: Puede ofrecer servicios inmediatamente. Se generan franjas de disponibilidad.
  </Card>
  <Card title="pending" icon="clock">
    **Esperando Aprobación**: El proveedor aún no está activo. No se generan franjas de disponibilidad. Usar para incorporación.
  </Card>
  <Card title="suspended" icon="ban">
    **Temporalmente Inactivo**: El proveedor está suspendido (licencia, acción disciplinaria). Sin franjas de disponibilidad.
  </Card>
</CardGroup>

## Pasos Posteriores a la Creación

Después de crear un proveedor, completa su configuración:

<Steps>
  <Step title="Configurar Horarios de Trabajo">
    Navega a [Configurar Horario](/providers/configure-schedule) para establecer los horarios de trabajo del proveedor.

    **Sin horarios de trabajo**: El proveedor NO tendrá disponibilidad (no se generan franjas).
  </Step>
  <Step title="Asignar Servicios">
    Navega a [Asignar Servicios](/providers/assign-services) para vincular al proveedor con los servicios que ofrece.

    **Sin asignaciones de servicios**: El proveedor no aparecerá cuando los pacientes reserven servicios específicos.
  </Step>
  <Step title="Verificar Disponibilidad">
    Prueba la disponibilidad simulando una reserva de cita para un servicio asignado a este proveedor.
  </Step>
  <Step title="Notificar al Proveedor">
    Envía credenciales de inicio de sesión e información de incorporación al nuevo proveedor.
  </Step>
</Steps>

## Errores Comunes

<AccordionGroup>
  <Accordion title="403 Forbidden - Cannot Manage Clinic">
    **Causa**: No tienes el rol `CLINIC_ADMIN` en la clínica seleccionada.

    **Solución**: Contacta a tu administrador del sistema para que te otorgue permisos `CLINIC_ADMIN` para esta clínica.
  </Accordion>

  <Accordion title="400 Bad Request - Email Already in Use">
    **Causa**: Ya existe un usuario con este correo electrónico globalmente.

    **Solución**:
    1. Busca al usuario existente en la sección **Usuarios**
    2. Si existe en tu clínica, usa el Método 1 para marcarlo como proveedor
    3. Si existe en otra clínica pero no en la tuya, agrégalo primero a tu clínica (crear asociación UserClinic)
  </Accordion>

  <Accordion title="400 Bad Request - Phone Already in Use">
    **Causa**: Ya existe un usuario con este número de teléfono globalmente.

    **Solución**: Similar al conflicto de correo electrónico. Localiza al usuario existente y márcalo como proveedor o verifica que el número de teléfono sea correcto.
  </Accordion>

  <Accordion title="400 Bad Request - Invalid Phone Format">
    **Causa**: El número de teléfono no está en formato E.164.

    **Solución**: Reformatea el número de teléfono a E.164. Ejemplos:
    - España: `+34` + número de 9 dígitos
    - EE.UU.: `+1` + número de 10 dígitos
    - México: `+52` + número de 10 dígitos
  </Accordion>
</AccordionGroup>

## Próximos Pasos

<CardGroup cols={2}>
  <Card title="Configurar Horario" icon="calendar-days" href="/providers/configure-schedule">
    Establece los horarios de trabajo del proveedor (REQUERIDO para disponibilidad)
  </Card>
  <Card title="Asignar Servicios" icon="briefcase-medical" href="/providers/assign-services">
    Vincula al proveedor con los servicios que ofrece
  </Card>
  <Card title="Ver Proveedores" icon="list" href="/providers/view-providers">
    Ve la lista actualizada de proveedores con tu nuevo proveedor
  </Card>
  <Card title="Probar Disponibilidad" icon="calendar-check" href="/scheduling/test-availability">
    Verifica que el proveedor aparezca en la reserva de citas
  </Card>
</CardGroup>
