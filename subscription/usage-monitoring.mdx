---
title: "Monitoreo de Uso"
description: "Seguimiento detallado de citas, conversaciones, límites del plan y costos estimados con overage"
icon: "chart-line"
---

## Introducción

El **monitoreo de uso** permite a las clínicas consultar en tiempo real cuántas citas han creado en el período actual, cuántas quedan disponibles, y el costo estimado del mes considerando overage.

## Endpoint REST API

### GET /v1/subscription/usage

Devuelve estadísticas de uso detalladas para el período de facturación actual.

**Autenticación**: Requiere token JWT válido (cookie `access_token`).

**Query Parameters**:
- `clinic_id` (UUID, required): ID de la clínica

**Response Schema** (`UsageResponse`):
```json
{
  "period_start": "2026-01-01T00:00:00Z",
  "period_end": "2026-02-01T00:00:00Z",
  "days_remaining": 16,
  "plan_name": "STARTER",
  "plan_display_name": "Starter Plan",
  "appointment_limit": 50,
  "appointments_used": 35,
  "appointments_remaining": 15,
  "usage_percent": 70.0,
  "overage_enabled": true,
  "overage_count": 0,
  "overage_rate": 0.35,
  "conversations_count": 12,
  "estimated_monthly_cost": {
    "base_cost": 29.0,
    "overage_cost": 0.0,
    "total_cost": 29.0
  }
}
```

<Frame>
  <img src="/images/screenshots/subscription_usage_chart.png" alt="Gráfico de uso del plan mostrando citas consumidas, restantes y proyección de costos" />
</Frame>

## Cómo Ver tu Uso

Puedes consultar tu uso actual desde el Dashboard principal de la clínica. El widget de suscripción muestra en tiempo real todas las métricas importantes.

## Interpretación de Campos

### Período de Facturación

| Campo | Tipo | Descripción |
|-------|------|-------------|
| `period_start` | datetime | Inicio del período actual (UTC) |
| `period_end` | datetime | Fin del período actual (UTC) |
| `days_remaining` | integer | Días hasta el próximo período |

El sistema calcula automáticamente cuántos días quedan hasta el próximo período de facturación.

### Uso de Citas

| Campo | Tipo | Descripción |
|-------|------|-------------|
| `appointment_limit` | integer | Límite de citas del plan |
| `appointments_used` | integer | Citas creadas en el período actual |
| `appointments_remaining` | integer | Citas disponibles (limit - used) |
| `usage_percent` | float | Porcentaje de uso (0-100+) |

**Cálculo de porcentaje de uso**: Se calcula dividiendo las citas usadas entre el límite y multiplicando por 100.
Ejemplo: 35 citas usadas / 50 límite = 70%

<Note>
  `usage_percent` puede ser mayor a 100% si overage está habilitado y la clínica excedió el límite.
</Note>

### Overage

| Campo | Tipo | Descripción |
|-------|------|-------------|
| `overage_enabled` | boolean | Si el overage está habilitado (`allow_overage`) |
| `overage_count` | integer | Citas extras sobre el límite (max(0, used - limit)) |
| `overage_rate` | float | Precio por cita extra |

**Cálculo de overage**: Si excedes el límite, el sistema cuenta las citas extras. Ejemplo: 65 citas usadas - 50 límite = 15 citas en overage

### Costo Estimado

| Campo | Tipo | Descripción |
|-------|------|-------------|
| `base_cost` | float | Precio mensual del plan |
| `overage_cost` | float | Costo adicional por overage (count × rate) |
| `total_cost` | float | Costo total estimado del mes |

**Cálculo de costo estimado**:
- Costo base = Precio mensual de tu plan
- Costo overage = Citas extras × Tarifa de overage
- Total = Costo base + Costo overage

Ejemplo: Plan STARTER (€29) + 15 citas extras × €0.35 = €29 + €5.25 = €34.25

## Verificación de Límite

El sistema verifica automáticamente si puedes crear nuevas citas:

- **Límite NO excedido**: Puedes crear citas normalmente
- **Límite excedido + Overage habilitado**: Puedes continuar creando citas (con cargo adicional)
- **Límite excedido + Overage NO habilitado**: Debes hacer upgrade para crear más citas

## Casos de Uso Comunes

### 1. Dashboard de Uso (Widget)

**Componente Frontend**: Widget de dashboard que muestra estadísticas de uso en tiempo real.

**Elementos visuales**:
- **Progress circular**: Muestra porcentaje de uso (0-100%)
  - Verde: uso normal (&lt;80%)
  - Naranja: cerca del límite (80-100%)
  - Rojo: overage activo (&gt;100%)

- **Estadísticas principales**:
  - Citas usadas / límite
  - Citas disponibles o count de overage
  - Días restantes en período

- **Alerta de overage** (si aplica):
  - Fondo naranja con borde
  - Cálculo: [overage_count] × €[overage_rate] = €[total]

- **Costo estimado**:
  - Costo base del plan
  - Costo de overage (si aplica)
  - Total estimado del mes

El widget se actualiza automáticamente cada minuto para mostrarte información actualizada.

### 2. Alertas Automáticas

El sistema envía alertas por email cuando:
- **80% de uso**: Advertencia de que te acercas al límite
- **100% de uso**: Límite alcanzado (si NO tienes overage habilitado)
- **Overage activo**: Confirmación de que estás usando citas extras con cargo adicional

## Reset de Contador

El contador de citas usadas se resetea automáticamente al inicio de cada nuevo período de facturación.

Cuando se procesa el pago de tu factura mensual, el sistema:
1. Actualiza las fechas del nuevo período de facturación
2. Resetea el contador de citas a 0
3. Resetea el contador de conversaciones a 0

<Note>
Este reset es completamente automático. No requiere ninguna acción de tu parte.
</Note>

## Errores Comunes

### 404 Not Found

```json
{
  "detail": "No subscription found for clinic"
}
```

**Causa**: La clínica no tiene suscripción configurada.

**Solución**: Contacta a soporte técnico para configurar tu suscripción.

### 403 Forbidden

```json
{
  "detail": "No access to clinic abc-123-def-456"
}
```

**Causa**: El usuario autenticado no tiene acceso a la clínica especificada.

**Solución**: Verificar que el `clinic_id` en el token JWT coincide con el `clinic_id` del query parameter.

## Próximos Pasos

<CardGroup cols={2}>
  <Card title="Ver Plan Actual" icon="eye" href="/subscription/view-current-plan">
    Consulta detalles completos de la suscripción
  </Card>
  <Card title="Upgrade de Plan" icon="arrow-trend-up" href="/subscription/upgrade-plan">
    Aumenta tu límite de citas
  </Card>
  <Card title="Downgrade de Plan" icon="arrow-trend-down" href="/subscription/downgrade-plan">
    Reduce tu plan con Subscription Schedules
  </Card>
  <Card title="Visión General" icon="arrow-left" href="/subscription/overview">
    Volver a la visión general
  </Card>
</CardGroup>

## Referencias

- [Stripe Invoices](https://stripe.com/docs/api/invoices)
- [Stripe Billing Webhooks](https://stripe.com/docs/billing/webhooks)
- [React Circular Progressbar](https://www.npmjs.com/package/react-circular-progressbar)
